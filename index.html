<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Controle de Estoque</title>

  <!-- Bloqueio de acesso direto se n√£o estiver logado -->
 <script>
  if (!sessionStorage.getItem('estoque_logado')) {
    window.location.href = 'login_estoque.html';
  }
</script>

  <!-- bump de vers√£o para limpar cache -->
  <link rel="stylesheet" href="style.css?v=15">
  <!-- PATCH visual da aba Solicita√ß√µes (independente do style.css) -->
<style id="solic-patch">
  /* .main em COLUNA e centralizada s√≥ na aba Solicita√ß√µes */
  .main.solic-flex{
    display:flex !important;
    flex-direction: column !important;   /* <<< aqui est√° a corre√ß√£o */
    align-items: center !important;      /* centraliza os filhos na horizontal */
  }
  .main.solic-flex > .topbar{ width:100% !important; }

  /* bloco Solicita√ß√µes centralizado e com largura m√°xima */
  #solicitacoes{
    width:100% !important;
    max-width:1200px !important;
    margin:0 auto !important;
    box-sizing:border-box !important;
  }

  /* grid interna: form menor, lista maior */
  #solicitacoes .grid-solic{
    display:grid !important;
    grid-template-columns:0.34fr 0.66fr !important;
    gap:16px !important;
    align-items:flex-start !important;
  }
  @media (max-width:1024px){
    #solicitacoes .grid-solic{ grid-template-columns:1fr !important; }
  }

  /* tabela est√°vel (sem texto em p√©) */
  #solicitacoes .table-responsive{ width:100% !important; overflow-x:auto !important; }
  #tabelaSolicitacoes{
    width:100% !important;
    border-collapse:collapse !important;
    table-layout:auto !important;
    min-width:760px !important;
  }
  #tabelaSolicitacoes th, #tabelaSolicitacoes td{
    padding:8px 10px !important;
    text-align:left !important;
    white-space:nowrap !important;
  }

  /* larguras (com Qtd) ‚Äì ajuste fino */
  #tabelaSolicitacoes th:nth-child(1), #tabelaSolicitacoes td:nth-child(1){ width:72px !important; }   /* ID */
  #tabelaSolicitacoes th:nth-child(2), #tabelaSolicitacoes td:nth-child(2){ width:24% !important; }    /* Material */
  #tabelaSolicitacoes th:nth-child(3), #tabelaSolicitacoes td:nth-child(3){ width:14% !important; }    /* Categoria */
  #tabelaSolicitacoes th:nth-child(4), #tabelaSolicitacoes td:nth-child(4){ width:8%  !important; }    /* Qtd */
  #tabelaSolicitacoes th:nth-child(5), #tabelaSolicitacoes td:nth-child(5){ width:18% !important; }    /* Motivo */
  #tabelaSolicitacoes th:nth-child(6), #tabelaSolicitacoes td:nth-child(6){ width:170px !important; }  /* Status */
  #tabelaSolicitacoes th:nth-child(7), #tabelaSolicitacoes td:nth-child(7){ width:130px !important; }  /* Prazo */
  #tabelaSolicitacoes th:nth-child(8), #tabelaSolicitacoes td:nth-child(8){ width:150px !important; }  /* Atualizado */
  #tabelaSolicitacoes th:nth-child(9), #tabelaS
</style>

<link rel="icon" href="logo.jpeg" type="image/jpeg">
</head>

<body>
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <h2>Menu</h2>

    <!-- √çcones (emojis) -->
    <button onclick="menuNavigate('dashboard')" aria-label="In√≠cio">üè† In√≠cio</button>
    <button onclick="menuNavigate('entrada')" aria-label="Entrada de Material">‚ûï Entrada</button>
    <button onclick="menuNavigate('saida')" aria-label="Sa√≠da de Material">‚ûñ Sa√≠da</button>
    <button onclick="menuNavigate('relatorioEstoque')" aria-label="Relat√≥rio de Estoque">üì¶ Estoque</button>
    <button onclick="menuNavigate('relatorioHistorico')" aria-label="Hist√≥rico">üïë Hist√≥rico</button>
    <button onclick="menuNavigate('materiais')" aria-label="Gerenciar Materiais">üõ†Ô∏è Materiais</button>
<!-- <button onclick="menuNavigate('solicitacoes')" aria-label="Solicita√ß√µes">üìã Solicita√ß√µes</button> -->


  </div>

  <!-- Overlay (apenas mobile) -->
  <div id="overlay" class="overlay" onclick="fecharSidebarMobile()"></div>

  <!-- Conte√∫do -->
  <div class="main">
    <!-- Topo -->
        <div class="topbar">
      <button class="toggle-sidebar" onclick="toggleSidebar()">‚ò∞ Menu</button>
      <h1 class="titulo-app">Controle de Estoque AmorSa√∫de Maring√°</h1>
      <!-- NOVO: bot√£o para o hub -->
      <button class="btn-hub" onclick="window.location.href='/hub.html'">‚Ü™ Hub de Sistemas</button>
    </div>


    <!-- DASHBOARD (inicial) -->
    <div id="dashboard" class="container" style="display:none;">
      <h2>Bem-vindo(a) üëã</h2>

      <div class="cards">
        <div class="card">
          <div class="card-title">Materiais cadastrados</div>
          <div class="card-value" id="cardMateriais">‚Äì</div>
        </div>
        <div class="card">
          <div class="card-title">Itens em estoque</div>
          <div class="card-value" id="cardEstoque">‚Äì</div>
        </div>
        <div class="card">
          <div class="card-title">Entradas (m√™s)</div>
          <div class="card-value" id="cardEntradasMes">‚Äì</div>
        </div>
        <div class="card">
          <div class="card-title">Sa√≠das (m√™s)</div>
          <div class="card-value" id="cardSaidasMes">‚Äì</div>
        </div>
      </div>

      <div class="actions">
        <button onclick="menuNavigate('entrada')">‚ûï Registrar Entrada</button>
        <button onclick="menuNavigate('saida')">‚ûñ Registrar Sa√≠da</button>
        <button onclick="menuNavigate('relatorioEstoque')">üì¶ Relat√≥rio de Estoque</button>
        <button onclick="menuNavigate('relatorioHistorico')">üïë Hist√≥rico</button>
        <button onclick="menuNavigate('solicitacoes')">üßæ Solicita√ß√µes</button>
      </div>

      <div class="grid-2">
        <div class="panel">
          <h3>‚ö†Ô∏è Estoque baixo (‚â§ 5)</h3>
          <div class="table-responsive">
            <table id="tabelaBaixoEstoque">
              <tr><th>Material</th><th>Qtd</th></tr>
            </table>
          </div>
        </div>

        <div class="panel">
          <h3>üïë √öltimas movimenta√ß√µes</h3>
          <div class="table-responsive">
            <table id="tabelaUltimasMov">
              <tr><th>Tipo</th><th>Material</th><th>Data</th><th>Qtd</th></tr>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ENTRADA -->
    <div id="entrada" class="container" style="display:none;">
      <h2>Entrada de Material</h2>
      <label>Material:</label>
      <select id="materialEntrada"></select>

      <label>Data de Chegada:</label>
      <input type="date" id="dataEntrada" />

      <label>Quantidade:</label>
      <input type="number" id="quantidadeEntrada" inputmode="numeric" />

      <label>Tipo:</label>
      <select id="tipoEntrada">
        <option value="unidade">Unidade</option>
        <option value="pacote">Pacote</option>
        <option value="caixa">Caixa</option>
      </select>

      <button onclick="registrarEntrada()">Registrar Entrada</button>
    </div>

    <!-- SA√çDA -->
    <div id="saida" class="container" style="display:none;">
      <h2>Sa√≠da de Material</h2>
      <label>Material:</label>
      <select id="materialSaida"></select>

      <label>Data de Sa√≠da:</label>
      <input type="date" id="dataSaida" />

      <label>Quantidade:</label>
      <input type="number" id="quantidadeSaida" inputmode="numeric" />

      <label>Respons√°vel:</label>
      <input type="text" id="responsavelSaida" />

      <button onclick="registrarSaida()">Registrar Sa√≠da</button>
    </div>

    <!-- RELAT√ìRIO DE ESTOQUE (por categoria) -->
    <div id="relatorioEstoque" class="container" style="display:none;">
      <h2>Relat√≥rio de Estoque por Categoria</h2>

      <!-- Bot√µes de categoria com √≠cones -->
      <div class="categorias-container">
        <button class="btn-categoria" onclick="abrirRelatorio('MATERIAL M√âDICO')" aria-label="Material M√©dico">ü©∫ Material M√©dico</button>
        <button class="btn-categoria" onclick="abrirRelatorio('MATERIAL GR√ÅFICO')" aria-label="Material Gr√°fico">üñ®Ô∏è Material Gr√°fico</button>
        <button class="btn-categoria" onclick="abrirRelatorio('MEDICA√á√ïES')" aria-label="Medica√ß√µes">üíä Medica√ß√µes</button>
        <!-- NOVOS -->
        <button class="btn-categoria" onclick="abrirRelatorio('DISPOSITIVOS')" aria-label="Dispositivos">üß∑ Dispositivos</button>
        <button class="btn-categoria" onclick="abrirRelatorio('MATERIAL DE ESCRIT√ìRIO')" aria-label="Material de Escrit√≥rio">üìí Material de Escrit√≥rio</button>
        <button class="btn-categoria" onclick="abrirRelatorio('COZINHA')" aria-label="Cozinha">üçΩÔ∏è Cozinha</button>
    <button class="btn-categoria" onclick="abrirRelatorio('DESCARTAVEL')" aria-label="Descart√°vel">üóëÔ∏è Descart√°vel</button>
    <button class="btn-categoria" onclick="abrirRelatorio('PRODUTOS')" aria-label="Produtos de Zeladoria">üß¥ Produtos</button>
          </div>
      <p class="hint">Clique em uma categoria para abrir o relat√≥rio detalhado em outra p√°gina.</p>

      <!-- (opcional) tabela geral oculta -->
      <div class="table-responsive" style="display:none;">
        <table id="tabelaEstoque">
          <tr><th>Material</th><th>Quantidade</th></tr>
        </table>
      </div>
    </div>

    <!-- HIST√ìRICO -->
    <div id="relatorioHistorico" class="container" style="display:none;">
      <h2>Hist√≥rico de Movimenta√ß√µes</h2>

      <!-- Exporta√ß√µes com √≠cones -->
      <div class="actions export-buttons" style="margin-bottom:10px;">
        <button class="btn-excel" onclick="exportarHistoricoExcel()">üì• Excel</button>
        <button class="btn-pdf" onclick="exportarHistoricoPDF()">üßæ PDF</button>
      </div>

      <div class="table-responsive">
        <table id="tabelaHistorico">
          <tr><th>Tipo</th><th>Material</th><th>Data</th><th>Quantidade</th><th>Detalhes</th></tr>
        </table>
      </div>
    </div>
    
<div id="solicitacoes" class="container" style="display:none;" data-offline="true">
  <h2>Solicita√ß√µes de Compras</h2>

  <!-- BLOCO 1: NOVA SOLICITA√á√ÉO -->
  <div class="panel bloc-nova">
    <h3>Nova Solicita√ß√£o</h3>

    <label>Nome do Material</label>
    <input type="text" id="sol_nome" autocomplete="off" />

    <label>Categoria</label>
    <select id="sol_categoria">
      <option value="MATERIAL GR√ÅFICO">MATERIAL GR√ÅFICO</option>
      <option value="MATERIAL M√âDICO">MATERIAL M√âDICO</option>
      <option value="MEDICA√á√ïES">MEDICA√á√ïES</option>
      <option value="DISPOSITIVOS">DISPOSITIVOS</option>
      <option value="MATERIAL DE ESCRIT√ìRIO">MATERIAL DE ESCRIT√ìRIO</option>
    </select>

    <label>Quantidade</label>
    <input type="number" id="sol_qtd" min="1" step="1" value="1" />

    <label>Motivo</label>
    <textarea id="sol_motivo" rows="3"></textarea>

    <label>Prazo (opcional)</label>
    <input type="date" id="sol_prazo" />

    <button id="btnCriarSolic" type="button" onclick="criarSolicitacao()">Enviar</button>
  </div>

  <!-- BLOCO 2: LISTA / HIST√ìRICO -->
  <div class="panel bloc-lista">
    <h3>Solicita√ß√µes em Aberto / Hist√≥rico</h3>
    <div class="table-responsive">
      <table id="tabelaSolicitacoes">
        <thead>
          <tr>
            <th>ID</th>
            <th>Material</th>
            <th>Categoria</th>
            <th>Qtd</th>
            <th>Motivo</th>
            <th>Status</th>
            <th>Prazo</th>
            <th>Atualizado</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>



    <!-- GERENCIAR MATERIAIS -->
    <div id="materiais" class="container" style="display:none;">
      <h2>Gerenciar Materiais</h2>

      <!-- Exporta√ß√µes com √≠cones -->
      <div class="actions export-buttons" style="margin-bottom:10px;">
        <button class="btn-excel" onclick="exportarMateriaisExcel()">üì• Excel</button>
        <button class="btn-pdf" onclick="exportarMateriaisPDF()">üßæ PDF</button>
      </div>

      <label>Nome do Material:</label>
      <input type="text" id="novoMaterial" />

      <label>Tipo do Material:</label>
      <select id="tipoMaterial">
        <option value="MATERIAL GR√ÅFICO">MATERIAL GR√ÅFICO</option>
        <option value="MATERIAL M√âDICO">MATERIAL M√âDICO</option>
        <option value="MEDICA√á√ïES">MEDICA√á√ïES</option>
        <!-- NOVOS -->
        <option value="DISPOSITIVOS">DISPOSITIVOS</option>
        <option value="MATERIAL DE ESCRIT√ìRIO">MATERIAL DE ESCRIT√ìRIO</option>
        <option value="COZINHA">COZINHA</option>
        <option value="DESCARTAVEL">DESCARTAVEL</option>
        <option value="PRODUTOS">PRODUTOS</option>
              </select>

      <button onclick="adicionarMaterial()">Adicionar Material</button>

      <div id="listaMateriais" style="margin-top: 20px;"></div>
    </div>
  </div>
  
  

  <!-- JS principal do sistema -->
<script src="script.js?v=18"></script>
  <!-- JS de layout/menu + exporta√ß√µes -->
  <script>
    /* ====== MENU OPTATIVO COM PERSIST√äNCIA ====== */
    function isMobileView() {
      return window.matchMedia('(max-width: 900px)').matches;
    }

    function applySidebarState(fromStorage=false) {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');
      const open = localStorage.getItem('sidebarOpen') === 'true';
      sidebar.classList.toggle('open', open);
      if (isMobileView()) {
        overlay.classList.toggle('show', open);
      } else {
        overlay.classList.remove('show');
      }
      if (!fromStorage) {
        localStorage.setItem('sidebarOpen', open ? 'true' : 'false');
      }
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');
      const willOpen = !sidebar.classList.contains('open');
      sidebar.classList.toggle('open', willOpen);
      localStorage.setItem('sidebarOpen', willOpen ? 'true' : 'false');
      if (isMobileView()) overlay.classList.toggle('show', willOpen);
      else overlay.classList.remove('show');
    }

    function fecharSidebarMobile() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');
      sidebar.classList.remove('open');
      overlay.classList.remove('show');
      localStorage.setItem('sidebarOpen', 'false');
    }

    function menuNavigate(tela) {
      if (typeof mostrarTela === 'function') {
        mostrarTela(tela);
      }
      // No mobile, fecha ap√≥s navegar; no PC mant√©m o estado
      if (isMobileView()) {
        fecharSidebarMobile();
      }
    }

    function abrirRelatorio(tipo) {
      window.location.href = 'relatorio_categoria.html?tipo=' + encodeURIComponent(tipo);
    }

    function sair() {
      sessionStorage.removeItem("logado");
      window.location.href = "login.html";
    }

    // Estado inicial da sidebar + tela padr√£o (dashboard)
    document.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('sidebarOpen') === null) {
        localStorage.setItem('sidebarOpen', 'false'); // sempre come√ßa fechada
      }
      applySidebarState(true);

      if (typeof mostrarTela === 'function') {
        mostrarTela('dashboard');
      }
      if (typeof atualizarDashboard === 'function') {
        atualizarDashboard();
      }
    });

    // Ajusta overlay ao mudar de tamanho (PC <-> mobile)
    window.addEventListener('resize', () => applySidebarState(true));

    /* ====== EXPORTA√á√ïES (Hist√≥rico e Materiais) ====== */
    // Excel (CSV via PHP)
    function exportarHistoricoExcel() {
      window.location.href = 'exportar_historico_excel.php';
    }
    function exportarMateriaisExcel() {
      window.location.href = 'exportar_materiais_excel.php';
    }

    // PDF (impress√£o da tabela isolada)
    function exportarHistoricoPDF() {
      const tabela = document.getElementById('tabelaHistorico');
      imprimirTabelaComoPDF(tabela, 'Hist√≥rico de Movimenta√ß√µes');
    }
    function exportarMateriaisPDF() {
      const tabela = document.querySelector('#listaMateriais table');
      if (!tabela) { alert('A lista de materiais ainda n√£o foi carregada.'); return; }
      imprimirTabelaComoPDF(tabela, 'Gerenciar Materiais');
    }

    function imprimirTabelaComoPDF(tabelaEl, titulo) {
      if (!tabelaEl) return;
      const html = `
        <html>
        <head>
          <meta charset="utf-8">
          <title>${titulo}</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 20px; }
            h2 { margin: 0 0 12px 0; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid #999; padding: 8px; text-align: center; }
            th { background: #eee; }
          </style>
        </head>
        <body>
          <h2>${titulo}</h2>
          ${tabelaEl.outerHTML}
        </body>
        </html>
      `;
      const win = window.open('', '_blank');
      win.document.open();
      win.document.write(html);
      win.document.close();
      win.focus();
      win.print();
      // win.close(); // se quiser fechar automaticamente ap√≥s imprimir
    }
  </script>
  <script>
document.addEventListener('DOMContentLoaded', () => {
  const solicit = document.getElementById('solicitacoes');
  if (solicit && solicit.dataset.offline === "true") {
    // Se algu√©m acessar direto pela URL
    if (window.location.hash.includes('solicitacoes')) {
      alert("A aba de Solicita√ß√µes est√° temporariamente offline para manuten√ß√£o.");
      window.location.href = "index.html"; // volta para o in√≠cio
    }
  }
});
</script>

</body>
</html>
